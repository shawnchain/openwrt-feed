<%#
 Copyright 2018 Shawn Chain <shawn.chain@gmail.com>
-%>

<%+header%>
<h2 name="content"><%:MMDVMHost CFG%></h2>
<div id="content_syslog">
<textarea wrap="off" rows="<%=cfg:cmatch("\n")/2%>" id="syslog"><%=cfg:pcdata()%></textarea>
</div>

<script type="text/javascript">//<![CDATA[
    var tries = 0;
    function ok() {
            window.location = '<%=controller%>/admin/mmdvm/log';
    }
    function check() {
            window.setTimeout(ok, 10000);
    }
    function restart(button) {
            button.style.display = 'none';
            document.getElementById('reboot-message').parentNode.style.display = '';
            (new XHR()).post('<%=controller%>/admin/mmdvm/restart/call', { token: '<%=token%>' }, check);
    }
    function save() {
        //TODO - save configure
        alert("not implemented yet!");
        window.location = '<%=controller%>/admin/mmdvm/log';
    }
//]]></script>
<br/>
<input class="cbi-button cbi-button-reload" type="button" value="<%:Restart%>" onclick="restart(this)" />
<input class="cbi-button cbi-button-apply" type="button" value="<%:Save%>" onclick="save(this)" />
<p class="alert-message" style="display:none">
    <img src="<%=resource%>/icons/loading.gif" alt="<%:Loading%>" style="vertical-align:middle" />
    <span id="reboot-message"><%:Restarting MMDVMHost...%></span>
</p>

<%+footer%>