--- origin/CRC.cpp	2017-10-04 22:31:07.176442841 +0800
+++ patched/CRC.cpp	2017-10-04 22:30:41.764442841 +0800
@@ -118,6 +118,8 @@
 	0xEF1F, 0xFF3E, 0xCF5D, 0xDF7C, 0xAF9B, 0xBFBA, 0x8FD9, 0x9FF8,
 	0x6E17, 0x7E36, 0x4E55, 0x5E74, 0x2E93, 0x3EB2, 0x0ED1, 0x1EF0 };
 
+#define HI_BYTE(s) (s >> 8 & 0xff)
+#define LO_BYTE(s) (s & 0xff)
 
 bool CCRC::checkFiveBit(bool* in, unsigned int tcrc)
 {
@@ -150,20 +152,15 @@
 	assert(in != NULL);
 	assert(length > 2U);
 
-	union {
-		uint16_t crc16;
-		uint8_t  crc8[2U];
-	};
-
-	crc16 = 0U;
+	uint16_t crc16 = 0U;
 
 	for (unsigned i = 0U; i < (length - 2U); i++)
-		crc16 = (uint16_t(crc8[0U]) << 8) ^ CCITT16_TABLE2[crc8[1U] ^ in[i]];
+		crc16 = (uint16_t(LO_BYTE(crc16)) << 8) ^ CCITT16_TABLE2[HI_BYTE(crc16) ^ in[i]];
 
 	crc16 = ~crc16;
 
-	in[length - 1U] = crc8[0U];
-	in[length - 2U] = crc8[1U];
+	in[length - 1U] = LO_BYTE(crc16);
+	in[length - 2U] = HI_BYTE(crc16);
 }
 
 bool CCRC::checkCCITT162(const unsigned char *in, unsigned int length)
@@ -171,19 +168,14 @@
 	assert(in != NULL);
 	assert(length > 2U);
 
-	union {
-		uint16_t crc16;
-		uint8_t  crc8[2U];
-	};
-
-	crc16 = 0U;
+	uint16_t crc16 = 0U;
 
 	for (unsigned i = 0U; i < (length - 2U); i++)
-		crc16 = (uint16_t(crc8[0U]) << 8) ^ CCITT16_TABLE2[crc8[1U] ^ in[i]];
+		crc16 = (uint16_t(LO_BYTE(crc16)) << 8) ^ CCITT16_TABLE2[HI_BYTE(crc16) ^ in[i]];
 
 	crc16 = ~crc16;
 
-	return crc8[0U] == in[length - 1U] && crc8[1U] == in[length - 2U];
+	return LO_BYTE(crc16) == in[length - 1U] && HI_BYTE(crc16) == in[length - 2U];
 }
 
 void CCRC::addCCITT161(unsigned char *in, unsigned int length)
@@ -191,20 +183,15 @@
 	assert(in != NULL);
 	assert(length > 2U);
 
-	union {
-		uint16_t crc16;
-		uint8_t  crc8[2U];
-	};
-
-	crc16 = 0xFFFFU;
+	uint16_t crc16 = 0xFFFFU;
 
 	for (unsigned int i = 0U; i < (length - 2U); i++)
-		crc16 = uint16_t(crc8[1U]) ^ CCITT16_TABLE1[crc8[0U] ^ in[i]];
+		crc16 = uint16_t(HI_BYTE(crc16)) ^ CCITT16_TABLE1[LO_BYTE(crc16) ^ in[i]];
 
 	crc16 = ~crc16;
 
-	in[length - 2U] = crc8[0U];
-	in[length - 1U] = crc8[1U];
+	in[length - 2U] = LO_BYTE(crc16);
+	in[length - 1U] = HI_BYTE(crc16);
 }
 
 bool CCRC::checkCCITT161(const unsigned char *in, unsigned int length)
@@ -212,19 +199,14 @@
 	assert(in != NULL);
 	assert(length > 2U);
 
-	union {
-		uint16_t crc16;
-		uint8_t  crc8[2U];
-	};
-
-	crc16 = 0xFFFFU;
+	uint16_t crc16 = 0xFFFFU;
 
 	for (unsigned int i = 0U; i < (length - 2U); i++)
-		crc16 = uint16_t(crc8[1U]) ^ CCITT16_TABLE1[crc8[0U] ^ in[i]];
+		crc16 = uint16_t(HI_BYTE(crc16)) ^ CCITT16_TABLE1[LO_BYTE(crc16) ^ in[i]];
 
 	crc16 = ~crc16;
 
-	return crc8[0U] == in[length - 2U] && crc8[1U] == in[length - 1U];
+	return LO_BYTE(crc16) == in[length - 2U] && HI_BYTE(crc16) == in[length - 1U];
 }
 
 unsigned char CCRC::crc8(const unsigned char *in, unsigned int length)
@@ -238,3 +220,4 @@
 
 	return crc;
 }
+
